<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Planet - Aprendizaje de Colores / é¢œè‰²æ˜Ÿçƒå­¦ä¹ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0e29;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            overflow: hidden;
            height: 100vh;
            color: white;
        }
        
        /* å¤ªç©ºèƒŒæ™¯ */
        .space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(100, 100, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 100, 100, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(100, 255, 100, 0.1) 0%, transparent 50%);
        }
        
        /* æ˜Ÿçƒå®¹å™¨ */
        .planets-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        /* æ˜Ÿçƒæ ·å¼ */
        .planet {
            position: absolute;
            border-radius: 50%;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }
        
        .planet.red {
            left: 10%;
            top: 30%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b);
            animation: float 6s ease-in-out infinite;
        }
        
        .planet.blue {
            left: 50%;
            transform: translateX(-50%);
            top: 20%;
            width: 180px;
            height: 180px;
            background: radial-gradient(circle at 30% 30%, #3498db, #1a5276);
            animation: float 8s ease-in-out infinite 1s;
        }
        
        .planet.green {
            right: 10%;
            top: 40%;
            width: 140px;
            height: 140px;
            background: radial-gradient(circle at 30% 30%, #2ecc71, #1e8449);
            animation: float 7s ease-in-out infinite 0.5s;
        }
        
        /* æ˜Ÿçƒæ ‡ç­¾ - åŒè¯­ */
        .planet-label {
            position: absolute;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            text-align: center;
            line-height: 1.3;
            width: 120px;
        }
        
        .red-label {
            left: calc(10% + 150px/2);
            transform: translateX(-50%);
            top: calc(30% + 150px + 10px);
        }
        
        .blue-label {
            left: 50%;
            transform: translateX(-50%);
            top: calc(20% + 180px + 10px);
        }
        
        .green-label {
            right: calc(10% + 140px/2);
            transform: translateX(50%);
            top: calc(40% + 140px + 10px);
        }
        
        /* ä¸­å¿ƒè¶³çƒ */
        .soccer-ball {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            animation: rotate 10s linear infinite;
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.5);
        }
        
        .soccer-ball::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: black;
            transform: translateY(-50%);
        }
        
        .soccer-ball::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            background: black;
            transform: translateX(-50%);
        }
        
        /* æ¸¸æˆä¸»å®¹å™¨ */
        .game-container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
        }
        
        /* é¡¶éƒ¨ä¿¡æ¯æ  - åŒè¯­ */
        .game-header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid #f1c40f;
        }
        
        .game-title {
            font-size: 36px;
            margin-bottom: 10px;
            color: #f1c40f;
            text-shadow: 0 0 20px rgba(241, 196, 15, 0.7);
        }
        
        .game-subtitle {
            font-size: 18px;
            color: #ecf0f1;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .round-info {
            font-size: 24px;
            color: #ecf0f1;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* é¢œè‰²çƒæ˜¾ç¤ºåŒº - å±å¹•ä¸Šæ–¹ */
        .color-ball-display {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .color-ball {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            box-shadow: 
                0 0 60px currentColor,
                inset 0 0 40px rgba(255, 255, 255, 0.3);
            animation: pulse 2s ease-in-out infinite;
            border: 8px solid white;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s ease;
        }
        
        .color-ball.show {
            opacity: 1;
            transform: scale(1);
        }
        
        /* é¢œè‰²çƒåŠ¨ç”» */
        .color-ball.red {
            background: radial-gradient(circle at 35% 35%, #ff6b6b, #c0392b);
            color: #ff6b6b;
        }
        
        .color-ball.blue {
            background: radial-gradient(circle at 35% 35%, #3498db, #1a5276);
            color: #3498db;
        }
        
        .color-ball.green {
            background: radial-gradient(circle at 35% 35%, #2ecc71, #1e8449);
            color: #2ecc71;
        }
        
        /* é—®é¢˜æ˜¾ç¤º - åŒè¯­ */
        .question-container {
            position: absolute;
            top: 320px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
            max-width: 800px;
        }
        
        .question {
            font-size: 36px;
            margin-bottom: 10px;
            text-align: center;
            min-height: 50px;
            color: #f1c40f;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .question-translation {
            font-size: 28px;
            color: #bdc3c7;
            font-style: italic;
        }
        
        /* ç­”æ¡ˆæŒ‰é’® - åŒè¯­ */
        .answer-buttons {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            width: 90%;
            max-width: 900px;
            justify-content: center;
        }
        
        .answer-btn {
            padding: 20px 30px;
            font-size: 24px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            min-width: 200px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }
        
        .answer-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
        }
        
        .answer-btn:active {
            transform: translateY(-2px);
        }
        
        .answer-btn.rojo {
            background: linear-gradient(45deg, #ff6b6b, #c0392b);
        }
        
        .answer-btn.azul {
            background: linear-gradient(45deg, #3498db, #1a5276);
        }
        
        .answer-btn.verde {
            background: linear-gradient(45deg, #2ecc71, #1e8449);
        }
        
        .answer-label {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .answer-translation {
            font-size: 18px;
            opacity: 0.9;
        }
        
        /* åé¦ˆä¿¡æ¯ - åŒè¯­ */
        .feedback {
            position: absolute;
            bottom: 320px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            min-height: 60px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
            width: 90%;
            max-width: 800px;
        }
        
        .feedback-text {
            margin-bottom: 5px;
        }
        
        .feedback-translation {
            font-size: 24px;
            opacity: 0.9;
        }
        
        .feedback.correct {
            color: #2ecc71;
            animation: celebrate 0.5s ease;
        }
        
        .feedback.incorrect {
            color: #e74c3c;
            animation: shake 0.5s ease;
        }
        
        /* ç§¯åˆ†æ˜¾ç¤º - åŒè¯­ */
        .score-board {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border-top: 3px solid #f1c40f;
        }
        
        .score-title {
            font-size: 24px;
            color: #f1c40f;
            margin-bottom: 5px;
        }
        
        .score-subtitle {
            font-size: 18px;
            color: #bdc3c7;
            margin-bottom: 10px;
        }
        
        .score-value {
            font-size: 42px;
            color: white;
            font-weight: bold;
        }
        
        /* è¿›åº¦æ¡ - åŒè¯­ */
        .progress-container {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 0;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .progress-bar {
            height: 20px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        /* è®¡æ—¶å™¨ - åŒè¯­ */
        .timer-container {
            position: absolute;
            top: 250px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .timer {
            font-size: 28px;
            color: #f1c40f;
            font-weight: bold;
        }
        
        .timer-label {
            font-size: 16px;
            color: #bdc3c7;
            margin-bottom: 5px;
        }
        
        /* æ¸¸æˆç»“æŸç•Œé¢ - åŒè¯­ */
        .game-over {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 3px solid #f1c40f;
            width: 90%;
            max-width: 700px;
        }
        
        .game-over-title {
            font-size: 36px;
            color: #f1c40f;
            margin-bottom: 20px;
        }
        
        .game-over-subtitle {
            font-size: 24px;
            color: #ecf0f1;
            margin-bottom: 30px;
        }
        
        .final-score {
            font-size: 48px;
            color: white;
            margin: 20px 0;
        }
        
        .results-container {
            text-align: left;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .restart-btn {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .restart-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.5);
        }
        
        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        @keyframes rotate {
            0% { transform: translate(-50%, -50%) rotate(0); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 60px currentColor,
                          inset 0 0 40px rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 80px currentColor,
                          inset 0 0 60px rgba(255, 255, 255, 0.5);
            }
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* æ˜Ÿæ˜ŸåŠ¨ç”» */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* åŒè¯­æ–‡æœ¬å®¹å™¨ */
        .bilingual {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .english {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .answer-buttons {
                flex-direction: column;
                gap: 20px;
                bottom: 180px;
            }
            
            .answer-btn {
                width: 250px;
                height: 80px;
            }
            
            .color-ball-display {
                top: 80px;
            }
            
            .color-ball {
                width: 120px;
                height: 120px;
            }
            
            .question-container {
                top: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- å¤ªç©ºèƒŒæ™¯ -->
    <div class="space-background"></div>
    
    <!-- æ˜Ÿæ˜Ÿ -->
    <div class="stars" id="stars"></div>
    
    <!-- æ˜Ÿçƒ -->
    <div class="planets-container">
        <div class="planet red"></div>
        <div class="planet blue"></div>
        <div class="planet green"></div>
        
        <div class="planet-label red-label">Planeta Rojo<br>çº¢è‰²æ˜Ÿçƒ</div>
        <div class="planet-label blue-label">Planeta Azul<br>è“è‰²æ˜Ÿçƒ</div>
        <div class="planet-label green-label">Planeta Verde<br>ç»¿è‰²æ˜Ÿçƒ</div>
        
        <div class="soccer-ball"></div>
    </div>
    
    <!-- é¢œè‰²çƒæ˜¾ç¤ºåŒºï¼ˆå±å¹•ä¸Šæ–¹ï¼‰ -->
    <div class="color-ball-display">
        <div class="color-ball" id="colorBall"></div>
    </div>
    
    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">Color Planet ğŸŒŸ</h1>
            <div class="game-subtitle">Aprendizaje de Colores / é¢œè‰²æ˜Ÿçƒå­¦ä¹ </div>
            <div class="round-info" id="roundInfo"></div>
        </div>
        
        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-info">
                <span>Progreso / è¿›åº¦</span>
                <span id="progressText">0/5</span>
            </div>
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <!-- è®¡æ—¶å™¨ -->
        <div class="timer-container">
            <div class="timer-label">Tiempo / æ—¶é—´</div>
            <div class="timer" id="timer">03:00</div>
        </div>
        
        <!-- é—®é¢˜æ˜¾ç¤º -->
        <div class="question-container">
            <div class="question" id="question">Â¿QuÃ© color es?</div>
            <div class="question-translation" id="questionTranslation">è¿™æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ</div>
        </div>
        
        <!-- åé¦ˆä¿¡æ¯ -->
        <div class="feedback" id="feedback">
            <div class="feedback-text"></div>
            <div class="feedback-translation"></div>
        </div>
        
        <!-- ç­”æ¡ˆæŒ‰é’® -->
        <div class="answer-buttons">
            <button class="answer-btn rojo" onclick="checkAnswer('rojo')">
                <div class="answer-label">ROJO</div>
                <div class="answer-translation">çº¢è‰²</div>
            </button>
            <button class="answer-btn azul" onclick="checkAnswer('azul')">
                <div class="answer-label">AZUL</div>
                <div class="answer-translation">è“è‰²</div>
            </button>
            <button class="answer-btn verde" onclick="checkAnswer('verde')">
                <div class="answer-label">VERDE</div>
                <div class="answer-translation">ç»¿è‰²</div>
            </button>
        </div>
    </div>
    
    <!-- ç§¯åˆ†æ˜¾ç¤º -->
    <div class="score-board">
        <div class="score-title">PuntuaciÃ³n del Equipo</div>
        <div class="score-subtitle">å›¢é˜Ÿå¾—åˆ†</div>
        <div class="score-value" id="teamScore">0</div>
    </div>
    
    <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
    <div class="game-over" id="gameOver">
        <h2 class="game-over-title">Â¡Juego Terminado! ğŸ‰</h2>
        <div class="game-over-subtitle">æ¸¸æˆç»“æŸï¼</div>
        <div class="final-score" id="finalScore">0</div>
        
        <div class="results-container" id="resultsContainer">
            <!-- ç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
        
        <button class="restart-btn" onclick="restartGame()">
            Jugar Otra Vez / é‡æ–°å¼€å§‹
        </button>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const GAME_CONFIG = {
            totalRounds: 5,
            colors: ['rojo', 'azul', 'verde'],
            roundTimes: {
                1: 1 * 60 * 1000, // å­¦ä¹ æ¨¡å¼ï¼š1åˆ†é’Ÿï¼ˆæµ‹è¯•ç”¨ï¼Œå¯æ”¹å›3åˆ†é’Ÿï¼‰
                2: 1 * 60 * 1000, // åŠ é€Ÿæ¨¡å¼ï¼šæ¯è½®1åˆ†é’Ÿ
                3: 1 * 60 * 1000,
                4: 1 * 60 * 1000,
                5: 1 * 60 * 1000  // å† å†›æŒ‘æˆ˜ï¼š1åˆ†é’Ÿ
            },
            showTimes: {
                1: 2000, // å­¦ä¹ æ¨¡å¼ï¼š2ç§’/é¢œè‰²
                2: 1500, // ç¬¬2è½®ï¼š1.5ç§’/é¢œè‰²
                3: 1000, // ç¬¬3è½®ï¼š1ç§’/é¢œè‰²
                4: 800,  // ç¬¬4è½®ï¼š0.8ç§’/é¢œè‰²
                5: 500   // ç¬¬5è½®ï¼š0.5ç§’/é¢œè‰²
            },
            attemptsPerRound: {
                1: 5,   // å­¦ä¹ æ¨¡å¼ï¼š5æ¬¡
                2: 5,   // ç¬¬2è½®ï¼š5æ¬¡
                3: 5,   // ç¬¬3è½®ï¼š5æ¬¡
                4: 5,   // ç¬¬4è½®ï¼š5æ¬¡
                5: 10   // å† å†›æŒ‘æˆ˜ï¼š10æ¬¡
            }
        };

        // åŒè¯­æ–‡æœ¬é…ç½®
        const TEXT_CONFIG = {
            roundNames: {
                1: { es: 'Ronda 1 - Modo Aprendizaje', zh: 'ç¬¬1è½® - å­¦ä¹ æ¨¡å¼' },
                2: { es: 'Ronda 2 - Velocidad Media', zh: 'ç¬¬2è½® - ä¸­ç­‰é€Ÿåº¦' },
                3: { es: 'Ronda 3 - Velocidad Alta', zh: 'ç¬¬3è½® - å¿«é€Ÿ' },
                4: { es: 'Ronda 4 - Velocidad Muy Alta', zh: 'ç¬¬4è½® - æé€Ÿ' },
                5: { es: 'Ronda 5 - DesafÃ­o de CampeÃ³n', zh: 'ç¬¬5è½® - å† å†›æŒ‘æˆ˜' }
            },
            colors: {
                rojo: { es: 'ROJO', zh: 'çº¢è‰²' },
                azul: { es: 'AZUL', zh: 'è“è‰²' },
                verde: { es: 'VERDE', zh: 'ç»¿è‰²' }
            },
            feedback: {
                correct: { es: 'Â¡Correcto!', zh: 'æ­£ç¡®ï¼' },
                tryAgain: { es: 'Â¡Intenta de nuevo!', zh: 'å†è¯•è¯•ï¼' }
            },
            questions: {
                es: 'Â¿QuÃ© color es?',
                zh: 'è¿™æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ'
            }
        };

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentRound: 1,
            currentAttempt: 0,
            teamScore: 0,
            currentColor: '',
            startTime: null,
            timerInterval: null,
            remainingTime: 0,
            playerStats: [],
            reactions: [],
            showTimeout: null
        };

        // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const stars = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.opacity = Math.random() * 0.5 + 0.2;
                stars.appendChild(star);
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            createStars();
            startRound(1);
        }

        // å¼€å§‹æ–°çš„ä¸€è½®
        function startRound(round) {
            gameState.currentRound = round;
            gameState.currentAttempt = 0;
            gameState.startTime = Date.now();
            gameState.remainingTime = GAME_CONFIG.roundTimes[round];
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateRoundInfo();
            updateProgressBar();
            startTimer();
            
            // å¼€å§‹é¢œè‰²æ˜¾ç¤ºå¾ªç¯
            setTimeout(showNextColor, 1000);
        }

        // æ›´æ–°è½®æ¬¡ä¿¡æ¯
        function updateRoundInfo() {
            const roundInfo = TEXT_CONFIG.roundNames[gameState.currentRound];
            document.getElementById('roundInfo').textContent = 
                `${roundInfo.es} / ${roundInfo.zh}`;
            
            // æ›´æ–°é—®é¢˜ï¼ˆåŒè¯­ï¼‰
            document.getElementById('question').textContent = TEXT_CONFIG.questions.es;
            document.getElementById('questionTranslation').textContent = TEXT_CONFIG.questions.zh;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const totalAttempts = GAME_CONFIG.attemptsPerRound[gameState.currentRound];
            const progress = (gameState.currentAttempt / totalAttempts) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `${gameState.currentAttempt}/${totalAttempts}`;
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const timeLeft = gameState.remainingTime - (Date.now() - gameState.startTime);
            
            if (timeLeft <= 0) {
                clearInterval(gameState.timerInterval);
                clearTimeout(gameState.showTimeout);
                endRound();
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªé¢œè‰²
        function showNextColor() {
            if (gameState.currentAttempt >= GAME_CONFIG.attemptsPerRound[gameState.currentRound]) {
                endRound();
                return;
            }
            
            gameState.currentAttempt++;
            
            // éšæœºé€‰æ‹©é¢œè‰²
            const randomIndex = Math.floor(Math.random() * GAME_CONFIG.colors.length);
            gameState.currentColor = GAME_CONFIG.colors[randomIndex];
            
            // æ˜¾ç¤ºé¢œè‰²çƒ
            const colorBall = document.getElementById('colorBall');
            colorBall.className = 'color-ball ' + gameState.currentColor;
            setTimeout(() => {
                colorBall.classList.add('show');
            }, 10);
            
            // è®°å½•ååº”å¼€å§‹æ—¶é—´
            gameState.reactions.push({
                round: gameState.currentRound,
                color: gameState.currentColor,
                startTime: Date.now()
            });
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar();
            
            // è‡ªåŠ¨éšè—é¢œè‰²ï¼ˆå¦‚æœè¶…æ—¶ï¼‰
            const showTime = GAME_CONFIG.showTimes[gameState.currentRound];
            gameState.showTimeout = setTimeout(() => {
                if (gameState.currentColor) {
                    hideColorBall();
                    
                    // å¦‚æœè¶…æ—¶æ²¡æœ‰å›ç­”ï¼Œè®°å½•ä¸ºé”™è¯¯
                    setTimeout(() => {
                        if (gameState.currentColor) {
                            showFeedback(TEXT_CONFIG.feedback.tryAgain, false);
                            gameState.currentColor = '';
                            setTimeout(showNextColor, 500);
                        }
                    }, 500);
                }
            }, showTime);
        }

        // éšè—é¢œè‰²çƒ
        function hideColorBall() {
            const colorBall = document.getElementById('colorBall');
            colorBall.classList.remove('show');
            setTimeout(() => {
                colorBall.className = 'color-ball';
            }, 300);
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(answer) {
            if (!gameState.currentColor) return;
            
            clearTimeout(gameState.showTimeout);
            hideColorBall();
            
            const reaction = gameState.reactions[gameState.reactions.length - 1];
            const reactionTime = Date.now() - reaction.startTime;
            
            if (answer === gameState.currentColor) {
                // æ­£ç¡®
                gameState.teamScore++;
                updateTeamScore();
                showFeedback(TEXT_CONFIG.feedback.correct, true);
                
                // è®°å½•æ­£ç¡®ååº”
                reaction.correct = true;
                reaction.reactionTime = reactionTime;
            } else {
                // é”™è¯¯
                showFeedback(TEXT_CONFIG.feedback.tryAgain, false);
                
                // è®°å½•é”™è¯¯ååº”
                reaction.correct = false;
                reaction.reactionTime = reactionTime;
            }
            
            // é‡ç½®å½“å‰é¢œè‰²
            gameState.currentColor = '';
            
            // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€ä¸ªé¢œè‰²
            setTimeout(showNextColor, 1000);
        }

        // æ˜¾ç¤ºåé¦ˆï¼ˆåŒè¯­ï¼‰
        function showFeedback(messageType, isCorrect) {
            const feedback = document.getElementById('feedback');
            const textElement = feedback.querySelector('.feedback-text');
            const translationElement = feedback.querySelector('.feedback-translation');
            
            const message = isCorrect ? 
                `${messageType.es} ${TEXT_CONFIG.colors[gameState.currentColor].es}` :
                messageType.es;
                
            const translation = isCorrect ? 
                `${messageType.zh} ${TEXT_CONFIG.colors[gameState.currentColor].zh}` :
                messageType.zh;
            
            textElement.textContent = message;
            translationElement.textContent = translation;
            feedback.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
            
            // æ’­æ”¾éŸ³æ•ˆï¼ˆæ¨¡æ‹Ÿï¼‰
            if (isCorrect) {
                playSound('correct');
            } else {
                playSound('tryAgain');
            }
        }

        // æ’­æ”¾éŸ³æ•ˆï¼ˆæ¨¡æ‹Ÿï¼‰
        function playSound(type) {
            try {
                if (type === 'correct') {
                    // æ­£ç¡®éŸ³æ•ˆ - ä½¿ç”¨ç®€å•çš„éŸ³é¢‘API
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } else {
                    // é¼“åŠ±éŸ³æ•ˆ
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 400;
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }
            } catch (e) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥ï¼Œç»§ç»­æ¸¸æˆ');
            }
        }

        // æ›´æ–°å›¢é˜Ÿåˆ†æ•°
        function updateTeamScore() {
            document.getElementById('teamScore').textContent = gameState.teamScore;
        }

        // ç»“æŸå½“å‰è½®æ¬¡
        function endRound() {
            clearInterval(gameState.timerInterval);
            clearTimeout(gameState.showTimeout);
            
            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€è½®
            if (gameState.currentRound < GAME_CONFIG.totalRounds) {
                // æ˜¾ç¤ºè½®æ¬¡ç»“æŸä¿¡æ¯
                const feedback = document.getElementById('feedback');
                feedback.innerHTML = `
                    <div class="feedback-text">Â¡Ronda ${gameState.currentRound} completada!</div>
                    <div class="feedback-translation">ç¬¬${gameState.currentRound}è½®å®Œæˆï¼</div>
                `;
                feedback.className = 'feedback correct';
                
                // è¿›å…¥ä¸‹ä¸€è½®
                setTimeout(() => {
                    startRound(gameState.currentRound + 1);
                }, 2000);
            } else {
                // æ¸¸æˆç»“æŸ
                endGame();
            }
        }

        // æ¸¸æˆç»“æŸ
        function endGame() {
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('finalScore').textContent = gameState.teamScore;
            
            // ç”Ÿæˆç»“æœç»Ÿè®¡
            generateResults();
            
            // éšè—ä¸»æ¸¸æˆç•Œé¢
            document.querySelector('.game-container').style.display = 'none';
            document.querySelector('.score-board').style.display = 'none';
        }

        // ç”Ÿæˆç»“æœç»Ÿè®¡ï¼ˆåŒè¯­ï¼‰
        function generateResults() {
            const resultsContainer = document.getElementById('resultsContainer');
            let html = `
                <h3>EstadÃ­sticas del Juego / æ¸¸æˆç»Ÿè®¡:</h3>
                <ul style="list-style-type: none; padding-left: 0;">
            `;
            
            // è®¡ç®—æ€»ååº”æ—¶é—´
            const totalReactionTime = gameState.reactions.reduce((sum, reaction) => 
                sum + (reaction.reactionTime || 0), 0);
            const avgReactionTime = totalReactionTime / gameState.reactions.length;
            
            // è®¡ç®—å‡†ç¡®ç‡
            const correctAnswers = gameState.reactions.filter(r => r.correct).length;
            const accuracy = (correctAnswers / gameState.reactions.length * 100).toFixed(1);
            
            html += `
                <li>â±ï¸ Tiempo promedio de reacciÃ³n: ${avgReactionTime.toFixed(0)}ms<br>
                    å¹³å‡ååº”æ—¶é—´: ${avgReactionTime.toFixed(0)}æ¯«ç§’</li>
                <li>ğŸ¯ PrecisiÃ³n: ${accuracy}%<br>
                    å‡†ç¡®ç‡: ${accuracy}%</li>
                <li>ğŸ”¢ Total de respuestas: ${gameState.reactions.length}<br>
                    æ€»å›ç­”æ•°: ${gameState.reactions.length}</li>
                <li>âœ… Respuestas correctas: ${correctAnswers}<br>
                    æ­£ç¡®å›ç­”: ${correctAnswers}</li>
                <li>ğŸ† PuntuaciÃ³n del equipo: ${gameState.teamScore}<br>
                    å›¢é˜Ÿå¾—åˆ†: ${gameState.teamScore}</li>
            `;
            
            // æŒ‰é¢œè‰²ç»Ÿè®¡
            html += '<h4>Por Color / æŒ‰é¢œè‰²ç»Ÿè®¡:</h4><ul style="padding-left: 20px;">';
            GAME_CONFIG.colors.forEach(color => {
                const colorReactions = gameState.reactions.filter(r => r.color === color);
                const colorCorrect = colorReactions.filter(r => r.correct).length;
                const colorAccuracy = colorReactions.length > 0 ? 
                    (colorCorrect / colorReactions.length * 100).toFixed(1) : 0;
                
                html += `
                    <li>${TEXT_CONFIG.colors[color].es} (${TEXT_CONFIG.colors[color].zh}): 
                        ${colorAccuracy}% precisiÃ³n / å‡†ç¡®ç‡</li>
                `;
            });
            html += '</ul>';
            
            html += '</ul>';
            resultsContainer.innerHTML = html;
            
            // å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
            sendGameResults(gameState);
        }

        // å‘é€æ¸¸æˆç»“æœåˆ°æœåŠ¡å™¨
        async function sendGameResults(data) {
            try {
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        Name: getPlayerName(),
                        Score3: data.teamScore,
                        ReactionTime: data.reactions.reduce((sum, r) => sum + (r.reactionTime || 0), 0) / data.reactions.length,
                        Accuracy: (data.reactions.filter(r => r.correct).length / data.reactions.length * 100).toFixed(1),
                        GameType: 'ColorPlanet'
                    })
                });
                
                const result = await response.json();
                console.log('æ¸¸æˆç»“æœå·²ä¿å­˜:', result);
            } catch (error) {
                console.error('ä¿å­˜ç»“æœå¤±è´¥:', error);
            }
        }

        // è·å–ç©å®¶åå­—
        function getPlayerName() {
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name');
            return name || 'Jugador';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                currentRound: 1,
                currentAttempt: 0,
                teamScore: 0,
                currentColor: '',
                startTime: null,
                timerInterval: null,
                remainingTime: 0,
                playerStats: [],
                reactions: [],
                showTimeout: null
            };
            
            // éšè—æ¸¸æˆç»“æŸç•Œé¢
            document.getElementById('gameOver').style.display = 'none';
            
            // æ˜¾ç¤ºä¸»æ¸¸æˆç•Œé¢
            document.querySelector('.game-container').style.display = 'flex';
            document.querySelector('.score-board').style.display = 'block';
            
            // é‡ç½®æ˜¾ç¤º
            document.getElementById('teamScore').textContent = '0';
            document.getElementById('colorBall').className = 'color-ball';
            document.getElementById('feedback').innerHTML = 
                '<div class="feedback-text"></div><div class="feedback-translation"></div>';
            
            // å¼€å§‹æ–°æ¸¸æˆ
            startGame();
        }

        // é¡µé¢åŠ è½½æ—¶å¼€å§‹æ¸¸æˆ
        window.onload = function() {
            const playerName = getPlayerName();
            document.title = `Color Planet - ${playerName}`;
            startGame();
        };
    </script>
</body>
</html>