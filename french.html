<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¤§åç‹ç‹¸çš„æ³•è¯­æ£®æ— H5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(#ffe9c9, #fff);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }
    .app {
      width: 100%;
      max-width: 480px;
      background: #fff7ea;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      padding: 16px;
    }
    h1 {
      font-size: 20px;
      text-align: center;
      margin-bottom: 8px;
    }
    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .nav button {
      flex: 1;
      padding: 6px 4px;
      font-size: 12px;
      border-radius: 999px;
      border: none;
      background: #ffe0b2;
      color: #6a3b0b;
      cursor: pointer;
      white-space: nowrap;
    }
    .nav button.active {
      background: #ff9800;
      color: #fff;
      font-weight: bold;
    }
    .nav button:active {
      transform: scale(0.97);
    }
    .screen {
      display: none;
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      min-height: 260px;
    }
    .screen.active {
      display: block;
    }
    .question {
      font-size: 16px;
      margin-bottom: 10px;
    }
    .big-fox {
      font-size: 50px;
      text-align: center;
      margin-bottom: 8px;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .options button {
      flex: 1 1 calc(50% - 8px);
      padding: 8px;
      font-size: 14px;
      border-radius: 10px;
      border: none;
      background: #ffe0b2;
      cursor: pointer;
    }
    .options button.correct {
      background: #8bc34a;
      color: #fff;
    }
    .options button.wrong {
      background: #f44336;
      color: #fff;
    }
    .feedback {
      margin-top: 8px;
      font-size: 14px;
      min-height: 20px;
    }
    .score {
      font-size: 13px;
      color: #555;
      margin-top: 4px;
    }
    .egg {
      width: 80px;
      height: 110px;
      background: #fff;
      border-radius: 50% 50% 45% 45%;
      margin: 0 auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      border: 3px solid #e0e0e0;
    }
    .color-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }
    .color-btn {
      flex: 1 1 calc(33.33% - 6px);
      padding: 6px;
      border-radius: 8px;
      border: none;
      font-size: 12px;
      color: #333;
      cursor: pointer;
    }
    .tip {
      margin-top: 8px;
      font-size: 13px;
      color: #555;
      min-height: 32px;
    }
    .animal-card {
      text-align: center;
      font-size: 16px;
      margin-top: 10px;
    }
    .animal-emoji {
      font-size: 40px;
      margin-bottom: 4px;
    }
    .egg-list {
      font-size: 28px;
      text-align: center;
      margin: 10px 0;
      word-wrap: break-word;
    }
    .number-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .number-buttons button {
      flex: 1 1 calc(33.33% - 6px);
      padding: 6px;
      border-radius: 8px;
      border: none;
      font-size: 13px;
      background: #ffe0b2;
      cursor: pointer;
    }
    .footer {
      text-align: center;
      font-size: 11px;
      color: #999;
      margin-top: 6px;
    }
  </style>
</head>
<body>
<div class="app">
  <h1>å¤§åç‹ç‹¸çš„æ³•è¯­æ£®æ—</h1>
  <div class="subtitle">é—®å€™ Â· åŠ¨ç‰© Â· é¢œè‰² Â· æ•°å­—</div>

  <div class="nav">
    <button class="active" data-target="screen-greeting">é—®å€™æ¸¸æˆ</button>
    <button data-target="screen-animal">åŠ¨ç‰©å«å£°</button>
    <button data-target="screen-color">å½©è‰²é¸¡è›‹</button>
    <button data-target="screen-number">æ•°å­—é¸¡è›‹</button>
  </div>

  <!-- æ¸¸æˆ1ï¼šé—®å€™é…å¯¹ -->
  <div class="screen active" id="screen-greeting">
    <div class="big-fox">ğŸ¦Š</div>
    <div class="question" id="greet-question"></div>
    <div class="options" id="greet-options"></div>
    <div class="feedback" id="greet-feedback"></div>
    <div class="score" id="greet-score"></div>
  </div>

  <!-- æ¸¸æˆ2ï¼šåŠ¨ç‰©å«å£° -->
  <div class="screen" id="screen-animal">
    <div class="question">ç‚¹ä¸€ç‚¹å‡»ï¼Œçœ‹çœ‹åŠ¨ç‰©æ€ä¹ˆç”¨æ³•è¯­è¯´è¯ï¼š</div>
    <div class="options" id="animal-buttons"></div>
    <div class="animal-card" id="animal-card">
      <div class="animal-emoji" id="animal-emoji">ğŸ”</div>
      <div id="animal-text">La Poule â€“ Cot-cot-codet !</div>
    </div>
  </div>

  <!-- æ¸¸æˆ3ï¼šå½©è‰²é¸¡è›‹ -->
  <div class="screen" id="screen-color">
    <div class="question">å¸®ç‹ç‹¸ç»™é¸¡è›‹ä¸Šè‰²ï¼Œé¡ºä¾¿å­¦é¢œè‰²ï¼š</div>
    <div class="egg" id="color-egg"></div>
    <div class="color-buttons" id="color-buttons"></div>
    <div class="tip" id="color-tip"></div>
  </div>

  <!-- æ¸¸æˆ4ï¼šæ•°å­—é¸¡è›‹ -->
  <div class="screen" id="screen-number">
    <div class="question" id="number-question">çœ‹çœ‹æœ‰å‡ ä¸ªé¸¡è›‹ï¼Ÿç”¨æ³•è¯­é€‰å‡ºæ¥ï¼š</div>
    <div class="egg-list" id="egg-list"></div>
    <div class="number-buttons" id="number-buttons"></div>
    <div class="feedback" id="number-feedback"></div>
    <div class="score" id="number-score"></div>
  </div>

  <div class="footer">é€‚é…æ•™æ¡ˆï¼šã€Šå¤§åç‹ç‹¸ã€‹æ³•è¯­å¯è’™Â·é—®å€™/åŠ¨ç‰©/é¢œè‰²/æ•°å­—</div>
</div>

<script>
  // åˆ‡æ¢æ¨¡å—
  const navButtons = document.querySelectorAll('.nav button');
  const screens = document.querySelectorAll('.screen');
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const target = btn.getAttribute('data-target');
      screens.forEach(sc => {
        sc.classList.toggle('active', sc.id === target);
      });
    });
  });

  // ---------- æ¸¸æˆ1ï¼šé—®å€™é…å¯¹ ----------
  const greetQuestions = [
    {
      zh: 'ç™½å¤©è·Ÿåˆ«äººç¤¼è²Œåœ°è¯´â€œä½ å¥½â€åº”è¯¥ç”¨ï¼š',
      correct: 'Bonjour',
      options: ['Bonjour', 'Bonne nuit', 'Salut']
    },
    {
      zh: 'æ™šä¸Šè§é¢æ—¶è¯´â€œæ™šä¸Šå¥½â€ï¼š',
      correct: 'Bonsoir',
      options: ['Bonsoir', 'Au revoir', 'Coucou']
    },
    {
      zh: 'å‡†å¤‡ç¡è§‰å‰å¯¹å°æœ‹å‹è¯´â€œæ™šå®‰â€ï¼š',
      correct: 'Bonne nuit',
      options: ['Bonne nuit', 'Bonjour', 'Salut']
    },
    {
      zh: 'è¦è¯´â€œå†è§â€ï¼Œæœ€æ ‡å‡†çš„ä¸€å¥æ˜¯ï¼š',
      correct: 'Au revoir',
      options: ['Au revoir', 'Salut', 'Bisous']
    },
    {
      zh: 'é‡åˆ°å¥½æœ‹å‹ï¼Œå¯ä»¥è½»æ¾åœ°è¯´ä¸€å¥â€œå—¨â€ï¼š',
      correct: 'Salut',
      options: ['Salut', 'Comment allez-vous ?', 'EnchantÃ©']
    }
  ];
  let greetIndex = 0;
  let greetScore = 0;
  const greetQ = document.getElementById('greet-question');
  const greetOptionsDiv = document.getElementById('greet-options');
  const greetFeedback = document.getElementById('greet-feedback');
  const greetScoreDiv = document.getElementById('greet-score');

  function loadGreetingQuestion() {
    const q = greetQuestions[greetIndex % greetQuestions.length];
    greetQ.textContent = q.zh;
    greetOptionsDiv.innerHTML = '';
    greetFeedback.textContent = '';
    q.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.addEventListener('click', () => {
        if (btn.classList.contains('correct') || btn.classList.contains('wrong')) return;
        if (opt === q.correct) {
          btn.classList.add('correct');
          greetFeedback.textContent = 'å¤ªæ£’äº†ï¼ğŸ¦Š è¯´ï¼š' + q.correct + 'ï¼';
          greetScore++;
          greetIndex++;
          setTimeout(loadGreetingQuestion, 800);
        } else {
          btn.classList.add('wrong');
          greetFeedback.textContent = 'å†æƒ³æƒ³ï½ç‹ç‹¸æç¤ºï¼šæ­£ç¡®çš„æ˜¯ ' + q.correct;
        }
        updateGreetScore();
      });
      greetOptionsDiv.appendChild(btn);
    });
    updateGreetScore();
  }

  let greetTotalQuestions = greetQuestions.length;

  function updateGreetScore() {
    let accuracy = ((greetScore / greetTotalQuestions) * 100).toFixed(2);
    greetScoreDiv.textContent = `å¾—åˆ†ï¼š${greetScore} åˆ† / æ­£ç¡®ç‡ï¼š${accuracy}%`;
  }

  loadGreetingQuestion();

  // ---------- æ¸¸æˆ2ï¼šåŠ¨ç‰©å«å£° ----------
  const animals = [
    { name: 'La Poule', zh: 'æ¯é¸¡', sound: 'Cot-cot-codet !', emoji: 'ğŸ”' },
    { name: 'Le Cochon', zh: 'çŒª', sound: 'Groin groin !', emoji: 'ğŸ·' },
    { name: 'Le Lapin', zh: 'å…”å­', sound: 'Hop ! Hop !', emoji: 'ğŸ°' },
    { name: 'Le Chien', zh: 'ç‹—', sound: 'Ouah ouah !', emoji: 'ğŸ¶' },
    { name: 'La Vache', zh: 'å¥¶ç‰›', sound: 'Meuhhh !', emoji: 'ğŸ®' },
    { name: 'Le Canard', zh: 'é¸­å­', sound: 'Coin coin !', emoji: 'ğŸ¦†' },
    { name: 'Le Mouton', zh: 'ç»µç¾Š', sound: 'BÃªÃªÃª !', emoji: 'ğŸ‘' }
  ];
  const animalButtonsDiv = document.getElementById('animal-buttons');
  const animalEmoji = document.getElementById('animal-emoji');
  const animalText = document.getElementById('animal-text');

// ä¿®æ”¹æ¸¸æˆ2ï¼šåŠ¨ç‰©å«å£°éƒ¨åˆ†ï¼Œæ·»åŠ æ’­æ”¾åŠŸèƒ½
const animalSounds = {
  'La Poule': 'audio/æ¯é¸¡.mp3',
  'Le Cochon': 'audio/çŒª.mp3',
  'Le Lapin': 'audio/å…”å­.mp3',
  'Le Chien': 'audio/ç‹—.mp3',
  'La Vache': 'audio/å¥¶ç‰›.mp3',
  'Le Canard': 'audio/é¸­å­.mp3',
  'Le Mouton': 'audio/ç»µç¾Š.mp3',
};

  // ä¿®æ”¹æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œæ’­æ”¾å£°éŸ³
  animals.forEach(a => {
    const btn = document.createElement('button');
    btn.textContent = a.zh + ' (' + a.name + ')';
    btn.addEventListener('click', () => {
      animalEmoji.textContent = a.emoji;
      animalText.textContent = a.name + ' â€“ ' + a.sound;

      // æ’­æ”¾ç›¸åº”çš„åŠ¨ç‰©å£°éŸ³
      const audio = new Audio(animalSounds[a.name]);
      audio.play();
    });
    animalButtonsDiv.appendChild(btn);
  });


  // ---------- æ¸¸æˆ3ï¼šå½©è‰²é¸¡è›‹ ----------
  const colorData = [
    { fr: 'Rouge', zh: 'çº¢è‰²ï¼šç‹ç‹¸çš„çš®æ¯› / ç”Ÿæ°”çš„è„¸', css: '#f44336' },
    { fr: 'Jaune', zh: 'é»„è‰²ï¼šå°é¸¡ (Le Poussin)', css: '#ffeb3b' },
    { fr: 'Bleu', zh: 'è“è‰²ï¼šå†œåœºçš„å¤©ç©º / å¿§éƒçš„å¿ƒæƒ…', css: '#2196f3' },
    { fr: 'Vert', zh: 'ç»¿è‰²ï¼šæ£®æ—çš„æ ‘å¶', css: '#4caf50' },
    { fr: 'Blanc', zh: 'ç™½è‰²ï¼šé¸¡è›‹ (L\'Å“uf)', css: '#ffffff' },
    { fr: 'Noir', zh: 'é»‘è‰²ï¼šå¤§ç°ç‹¼ (Le Loup) / æ·±å¤œ', css: '#000000' },
    { fr: 'Rose', zh: 'ç²‰çº¢è‰²ï¼šçŒª (Le Cochon) çš„çš®è‚¤', css: '#f48fb1' },
    { fr: 'Orange', zh: 'æ©™è‰²ï¼šçœŸæ­£çš„ç‹ç‹¸é¢œè‰²', css: '#ff9800' },
    { fr: 'Gris', zh: 'ç°è‰²ï¼šç°è‰²çš„ç‹¼æˆ–è€é¼ ', css: '#9e9e9e' }
  ];
  const colorEgg = document.getElementById('color-egg');
  const colorButtonsDiv = document.getElementById('color-buttons');
  const colorTip = document.getElementById('color-tip');

  colorData.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'color-btn';
    btn.style.background = c.css;
    btn.style.color = (c.css === '#000000') ? '#fff' : '#333';
    btn.textContent = c.fr;
    btn.addEventListener('click', () => {
      colorEgg.style.background = c.css;
      colorTip.textContent = c.fr + ' â€”â€” ' + c.zh;
    });
    colorButtonsDiv.appendChild(btn);
  });

  // ---------- æ¸¸æˆ4ï¼šæ•°å­—é¸¡è›‹ ----------
  const numberMap = [
    { num: 1, fr: 'Un' },
    { num: 2, fr: 'Deux' },
    { num: 3, fr: 'Trois' },
    { num: 4, fr: 'Quatre' },
    { num: 5, fr: 'Cinq' },
    { num: 6, fr: 'Six' },
    { num: 7, fr: 'Sept' },
    { num: 8, fr: 'Huit' },
    { num: 9, fr: 'Neuf' },
    { num: 10, fr: 'Dix' }
  ];
  const eggListDiv = document.getElementById('egg-list');
  const numberButtonsDiv = document.getElementById('number-buttons');
  const numberFeedback = document.getElementById('number-feedback');
  const numberScoreDiv = document.getElementById('number-score');
  let currentNumber = 1;
  let numberScore = 0;

  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function createNewNumberQuestion() {
    currentNumber = randomInt(1, 10);
    const eggs = 'ğŸ¥š'.repeat(currentNumber);
    eggListDiv.textContent = eggs;
    numberFeedback.textContent = '';
  }

  numberMap.forEach(item => {
    const btn = document.createElement('button');
    btn.textContent = item.fr;
    btn.addEventListener('click', () => {
      if (item.num === currentNumber) {
        numberFeedback.textContent = 'ç­”å¯¹å•¦ï¼' + item.fr + ' å°±æ˜¯ ' + item.num + ' ä¸ªé¸¡è›‹ï½';
        numberScore++;
        updateNumberScore();
        setTimeout(createNewNumberQuestion, 800);
      } else {
        numberFeedback.textContent = 'å†æƒ³æƒ³ï¼Œå°é¸¡ä»¬åœ¨å·å·ç¬‘ï½ æ­£ç¡®æ•°å­—æ˜¯ ' + currentNumber;
      }
    });
    numberButtonsDiv.appendChild(btn);
  });

  let numberTotalQuestions = numberMap.length;

  function updateNumberScore() {
    let accuracy = ((numberScore / numberTotalQuestions) * 100).toFixed(2);
    numberScoreDiv.textContent = `æ•°å­—å¾—åˆ†ï¼š${numberScore} åˆ† / æ­£ç¡®ç‡ï¼š${accuracy}%`;
  }

  createNewNumberQuestion();
  updateNumberScore();

  let last=null;
  function submitScore() {
    const greetAccuracy = ((greetScore / greetTotalQuestions) * 100).toFixed(2);
    const numberAccuracy = ((numberScore / numberTotalQuestions) * 100).toFixed(2);
    if(last===`${greetScore}-${greetAccuracy}-${numberScore}-${numberAccuracy}`){
      return;
    }
    last = `${greetScore}-${greetAccuracy}-${numberScore}-${numberAccuracy}`;
    console.log(`é—®å€™æ¸¸æˆå¾—åˆ†ï¼š${greetScore} åˆ†ï¼Œæ­£ç¡®ç‡ï¼š${greetAccuracy}%`);
    console.log(`æ•°å­—æ¸¸æˆå¾—åˆ†ï¼š${numberScore} åˆ†ï¼Œæ­£ç¡®ç‡ï¼š${numberAccuracy}%`);
    sendScore({Name:getName(), Score1:score,target:'https://api.airtable.com/v0/appl4YcGhBdkhHOiQ/Table%203',
      'é—®å€™åˆ†æ•°':greetScore,
      'é—®å€™æ­£ç¡®ç‡':greetAccuracy,
      'æ•°å­—åˆ†æ•°':numberScore,
      'æ•°å­—äº‰å–ç‡':numberAccuracy
    });
    // ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œæ›´å¤šçš„æ“ä½œï¼Œä¾‹å¦‚å‘é€åˆ†æ•°åˆ°æœåŠ¡å™¨
  }
        async function sendScore(body) {
            const loadingMessage = document.getElementById('loadingMessage');
            
            try {
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                const result = await response.json();
                loadingMessage.style.display = 'none';
                
                if (response.ok) {
                    console.log('Score erfolgreich gespeichert:', result);
                } else {
                    console.error('Fehler beim Speichern:', result);
                }
            } catch (error) {
                loadingMessage.style.display = 'none';
                console.error('Netzwerkfehler:', error);
            }
        }
  // å®šæ—¶è§¦å‘æäº¤åˆ†æ•°çš„å‡½æ•°
  setInterval(submitScore, 3000); // æ¯60ç§’æäº¤ä¸€æ¬¡åˆ†æ•°

</script>
</body>
</html>
